{{- if .Values.mcp.enabled }}
{{- range .Values.mcp.servers }}
{{- $server := . }}
---
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayBackend
metadata:
  name: {{ $server.backend.name | default $server.name }}
  namespace: {{ $server.backend.namespace | default ($server.namespace | default "agentgateway-system") }}
spec:
  mcp:
    targets:
      # Dynamic MCP: каждый сервер имеет свой Backend с selector по метке app
      - name: {{ $server.name }}
        selector:
          services:
            matchLabels:
              app: {{ $server.name }}
{{- end }}
{{- end }}
