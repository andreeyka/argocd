{{- if .Values.mcp.enabled }}
{{- if .Values.mcp.backend }}
---
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayBackend
metadata:
  name: {{ .Values.mcp.backend.name | default "mcp" }}
  namespace: {{ .Values.mcp.backend.namespace | default "agentgateway-system" }}
spec:
  mcp:
    targets:
      {{- range .Values.mcp.servers }}
      # Multiplex MCP: каждый сервер создает свой target в одном Backend
      # Все серверы доступны через один endpoint /mcp
      # Инструменты будут доступны с префиксом имени сервера (например: ia-mcp-1_tool-name)
      - name: {{ .name }}
        selector:
          services:
            matchLabels:
              app: {{ .name }}
      {{- end }}
{{- end }}
{{- end }}
