{{- if .Values.mcp.enabled }}
{{- range .Values.mcp.servers }}
{{- $server := . }}
{{- $route := $server.route | default dict }}
{{- if $route.enabled | default true }}
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: {{ $route.name | default $server.name }}
  namespace: {{ $route.namespace | default ($server.namespace | default "agentgateway-system") }}
spec:
  parentRefs:
    - name: {{ ($route.gateway | default dict).name | default "agentgateway-proxy" }}
      namespace: {{ ($route.gateway | default dict).namespace | default "agentgateway-system" }}
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: {{ $route.path | default (printf "/mcp/%s" $server.name) }}
      backendRefs:
        - name: {{ $server.backend.name | default $server.name }}
          group: agentgateway.dev
          kind: AgentgatewayBackend
{{- end }}
{{- end }}
{{- end }}