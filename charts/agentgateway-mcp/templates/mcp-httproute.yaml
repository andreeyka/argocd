{{- if .Values.mcp.enabled }}
{{- if .Values.mcp.route }}
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: {{ .Values.mcp.route.name | default "mcp" }}
  namespace: {{ .Values.mcp.route.namespace | default "agentgateway-system" }}
spec:
  parentRefs:
    - name: {{ (.Values.mcp.route.gateway | default dict).name | default "agentgateway-proxy" }}
      namespace: {{ (.Values.mcp.route.gateway | default dict).namespace | default "agentgateway-system" }}
  rules:
    # Multiplex MCP: один HTTPRoute для всех серверов
    # Все серверы доступны через один путь /mcp
    - backendRefs:
        - name: {{ .Values.mcp.backend.name | default "mcp" }}
          group: agentgateway.dev
          kind: AgentgatewayBackend
{{- end }}
{{- end }}
