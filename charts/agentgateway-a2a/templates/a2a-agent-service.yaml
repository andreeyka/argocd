{{- if .Values.a2a.agent.enabled }}
{{- range .Values.a2a.agent.agents }}
{{- $agent := . }}
{{- $service := $agent.service | default dict }}
{{- $deployment := $agent.deployment | default dict }}
---
apiVersion: v1
kind: Service
metadata:
  name: {{ $service.name | default (printf "a2a-%s" $agent.name) }}
  namespace: {{ $service.namespace | default "agentgateway-system" }}
spec:
  selector:
    app: {{ $deployment.name | default (printf "a2a-%s" $agent.name) }}
  type: ClusterIP
  ports:
    - protocol: TCP
      port: {{ $service.port | default 8000 }}
      targetPort: {{ $service.targetPort | default 8000 }}
      appProtocol: kgateway.dev/a2a
{{- end }}
{{- end }}